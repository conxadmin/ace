FROM jeanblanchard/busybox-java:8

MAINTAINER jeanblanchard

# Set env
ENV HTTP_PORT 9000
ENV ACE_SERVER localhost:9000
ENV ACE_OBR    localhost:9000
ENV OSGI_SHELL_TELNET_IP 127.0.0.1
ENV OSGI_SHELL_TELNET_PORT 6666
ENV OSGI_SHELL_TELNET_MAXCONN 2
ENV OSGI_SHELL_TELNET_SOCKETTIMEOUT 0

# install ace (for target only)
COPY distributions/conx-apache-ace-server-allinone.jar /root/conx-apache-ace-server-allinone.jar
COPY conf /root/conf/

##################################################################################################
## START CUSTOMIZATION

# Create a mount point
# VOLUME ["/data/apache-ace-server"]

# Expose ports
EXPOSE 6666 8080 9000

# Add the Apache Ace start script (executed on a `docker run`).
ADD init-container-script.sh /root/apache-ace-2.1.0/server-allinone/init_apache_ace_server.sh
RUN chmod +x /root/apache-ace-2.1.0/server-allinone/init_apache_ace_server.sh

# Add the Apache Ace start script (executed on a `docker run`).
ADD start-container-script.sh /root/apache-ace-2.1.0/server-allinone/start_apache_ace_server.sh
RUN chmod +x /root/apache-ace-2.1.0/server-allinone/start_apache_ace_server.sh

WORKDIR /root/apache-ace-2.1.0/server-allinone

# Use baseimage-docker's init system.
#CMD java -Dorg.osgi.service.http.port=9000 -Dorg.apache.ace.server=${ACE_SERVER} -Dorg.apache.ace.obr=${ACE_OBR} -jar server-allinone-noshell.jar
CMD ["sh","init_apache_ace_server.sh"]